<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type = "text/css" href="../mainpage.css?ver=1">
    <link rel="stylesheet" type="text/css" href="../css/css.css?ver=2">
    <link rel="stylesheet" type="text/css" href="../css/style.css?ver=3">
    <link rel="stylesheet" type="text/css" href="signupCss.css?ver=4">
    <link rel="stylesheet" type="text/css" href="../board/reset.css?ver=5">
    <link rel="stylesheet" href="../board/style.css?ver=6"> 
    <link rel = "icon" href="image/wave.ico">
    <script src="https://kit.fontawesome.com/47f0662df2.js" crossorigin="anonymous"></script>
    <style>
        #modal.modal-overlay {
            width: 3000px;
            height: 1000px;
            position: absolute;
            left: 0;
            top: 0;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(1.5px);
            -webkit-backdrop-filter: blur(1.5px);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        #modal .title {
            padding-left: 10px;
            display: inline;
            text-shadow: 1px 1px 2px gray;
            color: white;
            
        }
        #modal .title h2 {
            display: inline;
        }
        #modal .close-area {
            display: inline;
            float: right;
            padding-right: 10px;
            cursor: pointer;
            text-shadow: 1px 1px 2px gray;
            color: white;
        }
        
        #modal .content {
            margin-top: 20px;
            padding: 0px 10px;
            text-shadow: 1px 1px 2px gray;
            color: white;
        }
    </style>
    <title>Document</title>
        
        <!-- </div> -->
        <div id="titlebar">
            <a href="../mainpage.html"><img src="../main-image/title.png", alt="농장 이름", width="300",width="300"></a>
        </div>

        <div id="navbar">
            <div id="navbar-icon">
                <a href="../../mainpage.html"><i class="fa-solid fa-house"></i></a>
                <!--<i class="fa-solid fa-bars"></i>-->
            </div>

            <ul id="navbar-menu">
                <li><a href="../../introduce.html">소개</a></li> <!--소개 페이지 따로-->
                <li><a href="../../product/product.php">제품</a></li>
                <li><div class="dropdown">
                    <span class="dropbtn_icon"><a href="#" onclick= "location.href = 'boardpage.html' " >게시판</a></span>
                    <div class="dropdown-content">
                      <a href="boardpage.html">공지사항</a>
                      <a href="../Q&A/qnapage.html">Q&A</a>
                    </div>
                  </div></li>
            </ul>

            <ul id="navbar-login">
                <li><a onclick="hasToken()">마이페이지</a></li>
                <li><a id = "btn-modal">로그인/회원가입</a></li>
            </ul>

            <div id="modal" class="modal-overlay">
                <main id="app">
                    <h1 class="blind">로그인 및 회원가입창</h1>
                    <!-- 닫기 섹션 -->
                    <section class="top-close">
                      <p class="top-txt">&nbsp&nbsp&nbsp&nbsp로그인  또는  회원가입</p>
                        <button class="close">
                          <img src="./img/Vector 2.png" alt="">
                          <img src="./img/Vector 3.png" alt="">             
                        </button> 

                    </section>
                    <!-- 입력창 -->
                    <section class="user-input">
                      <h2 class="blind">아이디 비밀번호 입력창</h2>
                      <p class="msg">베리굿에서 맛있는 상품들을 구매해보세요 :)</p>
                      <label for="id"></label>
                      <input class="inp-id" type="text" id="id" required placeholder="아이디">
                      <label for="pw"></label>
                      <input class="inp-pw" type="password" id="pw" required placeholder="비밀번호">
                      <div class="check-wrap">
                        <input class="check-keep" type="checkbox" id="check" name="로그인상태유지">
                        <label for="check"> </label>
                        <span class="keep-txt">로그인 상태 유지</span>
                      </div>
                      <button class="log-btn" type="submit" onclick="didClickLoginBtn()" >로그인</button>
                      <ul class="join-find">
                        <li class="user-join"><a href="#none">회원가입</a></li>
                        <li><a href="#none">아이디/비밀번호 찾기</a></li>
                      </ul>
                      <div class="log-other">또는</div>
                    </section>
                    <!-- 다른계정로그인 -->
                    <section class="other-log">
                      <h2 class="blind">다른계정으로 로그인</h2>
                      <div class="other-btn">
                        <a class="log-glg btn glg" href="https://www.google.com" target="_blank">
                          <img src="./img/Google.png" alt="">
                          <div class="log-txt">구글 계정으로 로그인</div></a>
                
                        <a class="log-face btn face" href="https://www.facebook.com" target="_blank">
                          <img src="./img/facebook.png" alt="">          
                          <div class="log-txt">페이스북 계정으로 로그인</div></a>
                
                        <a class="log-naver btn naver" href="https://www.naver.com" target="_blank">
                          <img src="./img/naver.png" alt="">          
                          <div class="log-txt">네이버 계정으로 로그인</div></a>
                
                        <a class="log-kao btn kao" href="https://www.kakaocorp.com" target="_blank">
                          <img src="./img/message.png" alt="" >
                          <div class="log-txt">카카오톡 계정으로 로그인</div></a>
                      </div>
                    </section>
                  </main>
            </div>

        </div>

        <div id="wrap" class="wrapper">
            <form method ="post" name="join" id="join">
              <!-- 회원가입 타이틀부분 -->
               <header>
                  <div id="header">
                     <h1 class="h_loho">
                        <span><img alt="참치라이더 메인문구" src="wave.ico" style="width:60px; height:60px;"/></span>
      
                     </h1>
                     </div>
               </header>
      
               <div id="container">
                  <div class="row_group">
                     <div class="userInput">
              <!-- 아이디 입력 -->
                        <h3 class="list">아이디<span id="idError"></span></h3>
                        <span class="box int_id" ><input type="text" id="id" class="int check"
                           maxlength="20" required placeholder="아이디를 입력하세요."></span>
                     </div>
                     <div class="userInput">
              <!-- 비밀번호 입력 -->
                        <h3 class="list">비밀번호<span id="pwError"></span></h3>
                        <span class="box int_id"><input type="password" id="pw" class="int check"
                           maxlength="20" required placeholder="바밀번호를 입력하세요."></span>
                     </div>
              <!-- 비밀번호 재확인 입력 -->
                     <div class="userInput">
                        <h3 class="list">비밀번호 재확인<span id="pwCheckError"></span></h3>
                        <span class="box int_id">
                          <input type="password" id="pwCheck" class="int check" maxlength="20" required placeholder="바밀번호를 다시한번 입력하세요.">
                          </span>
                     </div>
                  </div>
                     <div class="row_group">
              <!-- 성명 입력 -->
                     <div class="userInput">
                        <h3 class="list">성명<span id="nameError"></span></h3>
                        <span class="box int_id"><input type="text" id="name" class="int check"
                           maxlength="20" required placeholder="성명을 입력하세요."></span>
                     </div>
              <!-- 전화번호 입력 -->
                     <div class="userInput">
                        <h3 class="list">전화번호("-" 제외)<span id="phoneNumError"></span></h3>
                        <span class="box int_id"><input type="text" id="phoneNum" class="int check"
                           maxlength="11" required placeholder="휴대폰 번호를 입력하세요."></span>
                     </div>
      
                     <!-- 이메일 입력 -->
                    <div class="userInput">
                      <h3 class="list">이메일<span id="emailError"></span></h3>
                      <span class="emailInt" id="emailBox"> <input type="text" id="email" maxlength="20" class="check" required placeholder="이메일 입력" > 
                         <span>   @ </span> 
                            <!-- 이메일 택일 -->
                            <select id="mail_Select">
                               <option>이메일 선택</option>
                               <option>naver.com</option>
                               <option>gmail.com</option>
                               <option>daum.net</option>
                               <option>hanmail.net</option>
                               <option>hotmail.com</option>
                               <option>nate.com</option>
                               <option>yahoo.co.kr</option>
                               <option>empas.com</option>
                               <option>freechal.com</option>
                               <option>lycos.co.kr</option>
                               <option>korea.com</option>
                               <option>hanmir.com</option>
                               <option>dreamwiz.com</option>
                               <option>paran.com</option>
                            </select>
                      </span>
                   </div>    
                   <div class="btn_area">
                      <input type="submit" value="가입하기" id="btnJoin" class="btn_type btn_primary">
                   </div>
                </div>
             </div>
          </form>
       </div>

</head>
<body>
    <div id ="product"></div>
    <div style="clear:both;"></div> <!--하단과 분리-->
        <hr/>

        <div id="second-cat"> <!--모든 페이지에 추가-->
            <div id="map"><h3>🔎오시는 길</h3>
                <!-- * 카카오맵 - 지도퍼가기 -->
                <!-- 1. 지도 노드 -->
                <div id="daumRoughmapContainer1671524483104" class="root_daum_roughmap root_daum_roughmap_landing" style="width:100%;"></div>

                <!--
                    2. 설치 스크립트
                    * 지도 퍼가기 서비스를 2개 이상 넣을 경우, 설치 스크립트는 하나만 삽입합니다.
                -->
                <script charset="UTF-8" class="daum_roughmap_loader_script" src="https://ssl.daumcdn.net/dmaps/map_js_init/roughmapLoader.js"></script>

                <!-- 3. 실행 스크립트 -->
                <script charset="UTF-8">
                    new daum.roughmap.Lander({
                        "timestamp" : "1671524483104",
                        "key" : "2d4ip",
                        //"mapWidth" : "350",
                        "mapHeight" : "175"
                    }).render();
                </script>
                <h4>베리굿 농장, 제주시 조천읍 와흘리 2419-2 </h4>
                </div>
            </div>
        
            <div id="copyright">
                <p><br><br>📞TEL : 010-9964-8294</p>
                <p>💰계좌 정보 : 농협 352-0944-0792-53 장주영</p>
                <img src="../main-image/title.png">
                <address>
                Copyright &copy, BERRYGOOD ALL. rights resevered<br>
                tre021040@naver.com<br><br>
                이용약관 <span id="personal-info"><a href="personal.html"
                    onclick="window.open(this.href,'_blank','width=800, height=600'); return false;">개인정보 처리방침</a></span>
            </address>
            </div>

            <script>
                window.localStorage.setItem('clickedPage', "btn1");
                var currentPage = 1;
    
    
                function changeclass(id) {
                    console.log(id);
                    document.getElementById(window.localStorage.getItem('clickedPage')).setAttribute("class", "num");
                    document.getElementById(id).setAttribute("class", "num on");
                    window.localStorage.setItem('clickedPage', id);
                    currentPage = id.slice(-1);
                    loadPage();
                    } 
                
                var noticeArray = new Object();
    
                window.onload = async function() {       
                    loadPage();
                }
    
    
                function loadPage(){
                    fetch(`http://3.36.62.87/forum/api/post/read.php?category=NOTICE&page=${currentPage}`, {
                        method: "GET",
                        headers: {
                          "Content-Type": "application/json",
                          "origin" : "http://3.36.62.87",
                          //"Cookie" : 'JWT=' + localStorage.getItem('jwt')
                        },
                        
                    }).then((response) => response.json())
                    .then((data) => {
                        noticeArray = data.data;
                        console.log(noticeArray);   
    
                        for(var i=0; i<5; i++){
                            var temp_title = "title_" + String(4-i);
                            var temp_writer = "writer_" + String(4-i);
                            var temp_date = "date_" + String(4-i);
                            var temp_count = "count_" + String(4-i);
                            var temp_num = "num_" + String(4-i);
                            document.getElementById(temp_num).innerHTML=data.data[i]._id;
    
                            document.getElementById(temp_title).innerHTML= `<a href='view.html'> ${data.data[i].title} </a>`
                            document.getElementById(temp_writer).innerHTML=data.data[i].author;
                            document.getElementById(temp_date).innerHTML=data.data[i].created_at;
                            document.getElementById(temp_count).innerHTML=data.data[i].views;
                            
                        }
                    });
                }
    
                function reply_click(clicked_id)
                {   
    
                    var temp_num = "num_" + clicked_id.slice(-1);
                    var id = document.getElementById(temp_num).innerHTML;
                        
                    window.localStorage.setItem('clicked_id', id);
                }
    
                function hasToken(){
                    fetch("http://3.36.62.87/user/api/is_login.php", {
                        method: "POST",
                        headers: {
                          "Content-Type": "application/json",
                          "origin" : "http://3.36.62.87",
                        },
                        body: JSON.stringify({
                            "JWT" : window.localStorage.getItem('jwt'),
                        }),
                        
                    }).then((response) => response.json())
                    .then((data) => {
                        console.log(data);
                        console.log(window.localStorage.getItem("isAdmin"));
                        if (data.message == "no jwt token"){
                            alert("로그인을 해주세요");
                        }
                        else if ((data.message == "user has jwt") && (window.localStorage.getItem("isAdmin")=="false")){
                            alert("허용된 접근이 아닙니다.");
                        }
                        else if ((data.message == "user has jwt") && (window.localStorage.getItem("isAdmin")=="true")){
                            window.location.replace("write.html");
                            console.log("왜안됨");
                        }
                        
                    
                    });
                    
                }
    
                const modal = document.getElementById("modal")
                function modalOn() {
                    modal.style.display = "flex"
                }
                function isModalOn() {
                    return modal.style.display === "flex"
                }
                function modalOff() {
                    modal.style.display = "none"
                }
                const btnModal = document.getElementById("btn-modal")
    
                btnModal.addEventListener("click", e => {
                    modalOn()
                })
    
                const closeBtn = modal.querySelector(".close")
    
                closeBtn.addEventListener("click", e => {
                    modalOff()
                })
    
                modal.addEventListener("click", e => {
                    const evTarget = e.target
                    if(evTarget.classList.contains("modal-overlay")) {
                        modalOff()
                    }
                })
                
                window.addEventListener("keyup", e => {
                    if(isModalOn() && e.key === "Escape") {
                        modalOff()
                    }
                })
    
    
                function didClickLoginBtn() {
    
                    const idToPost = document.getElementById('id').value;
                    const pwToPost = document.getElementById('pw').value;

                    fetch("http://3.36.62.87/user/api/login.php", {
                        method: "POST",
                        headers: {
                          "Content-Type": "application/json",
                          "origin" : "http://3.36.62.87"
                        },
                        body: JSON.stringify({
                            "id" : idToPost,
                            "password" : pwToPost
                        }),
                    }).then((response) => response.json())
                    .then((data) => {
                        window.localStorage.setItem('jwt', data.JWT); //JWT 저장해주는 방식
                        console.log(localStorage.getItem('jwt'));
                        if (idToPost=="administrator" && pwToPost=="administrator1!"){
                            window.localStorage.setItem('isAdmin', true );
                            alert("안녕하세요! 관리자님")
                        } 
                        else{
                            window.localStorage.setItem('isAdmin', false );
                            alert("안녕하세요!")
                        }
                        //`
                        window.location.replace("../../mainpage.html");
                            
                        });
                    
                        
                    
                }

                //회원가입 유효성검사
        // 자원을 화면에 로드하게 되면 수행할 동작(==function)
        window.onload = function() {

            var join = document.join; //form데이터를 모두 join변수에 저장
            
            // 유효성검사할 부분을 class로 부여했기에 check class 태그를 모두 input에 저장 가져옴
            // 이때 input 한 태그당 배열 인덱스로 받는다.
            var input = document.querySelectorAll('.check');

            // 오류 문구 //errorId : span의 id들(각 요소마다 나타낼 오류를 표시하기 위함)
            // error : class list의 하위 span을 모두 불러냄(일괄 처리를 위함 - 반복문)
            var errorId = [ "idError", "pwError", "pwCheckError", "nameError", "phoneNumError", "emailError" ];
            var error = document.querySelectorAll('.list > span');
        
            
            // 오류문구 초기화 메서드
            // 오류 표시 후, 사용자가 올바르게 수정을 하면 텍스트가 사라지는 모습을 구현
            function innerReset(error){
            for (var i = 0; i < error.length; i++) {
                error[i].innerHTML = "";
            }
            }

            // 초기화 메서드 호출
            innerReset(error);

            // [ ID 입력문자 유효성검사 ] 
            join.id.onkeydown = function(){
            innerReset(error); // 초기화 메서드 호출
            var idLimit = /^[a-zA-Z0-9-_]{5,20}$/; //정규식 5~20자 (a~z, A~Z, 0~9, -, _만 입력가능)
            if (!idLimit.test(input[0].value)) { //입력값과 정규식 범위와 같지 않다면
                // id의 오류 문구삽입
                document.getElementById(errorId[0]).innerHTML = "5~20자의 영문 소대문자, 숫자와 특수기호(_),(-)만 사용 가능합니다.";

            }
            }
            // [ PW 입력문자 유효성검사 ]
            join.pw.onkeydown = function(){
            innerReset(error); // 초기화 메서드 호출
            var pwLimit = /^[a-zA-Z0-9~!@#$%^&*()_-]{10,20}$/; //정규식(a~z, A~Z, 0~9, ~!@#$%^&*()_- 만 입력가능)
            if (!pwLimit.test(input[1].value)) { //입력값과 정규식 범위와 같지 않다면
                // pw의 오류 문구삽입
                document.getElementById(errorId[1]).innerHTML = " 10~20자의 영문 소대문자, 숫자와 특수기호 '~!@#$%^&*()_-'만 사용 가능합니다.";
            }   
            }
            // [ PW 재확인 입력문자 초기화 ]
            //비밀번호 동일여부는 submit 버튼 클릭시 검사해줄 예정
            join.pwCheck.onkeydown = function(){
            // pw의 오류 문구삽입
            innerReset(error);// 오류문구 초기화   
            }
            // [ 휴대폰번호 입력문자 유효성검사 ]
            join.phoneNum.onkeydown = function(){ //입력값과 정규식 범위와 같지 않다면
            innerReset(error); // 초기화 메서드 호출   
                var pnumLimit =  /^01[0|1|6|7|8|9]{1}[0-9]{8}$/; // 정규식(^$--> 문자의미, 01, (6자리중 "1자리"), 0~9--> "8자리")
                if (!pnumLimit.test(input[4].value)) { //입력값과 정규식 범위와 같지 않다면
                    // pw의 오류 문구삽입 
                    document.getElementById(errorId[4]).innerHTML = " 올바른 형식이 아닙니다. 다시 확인해주세요.";
                }
            }
            
            // [ 이메일 입력 유효성검사 ] 
            join.email.onkeydown = function(){ //입력값과 정규식 범위와 같지 않다면
                innerReset(error); // 초기화 메서드 호출
                var emailLimit = /[0-9a-zA-Z-_.]/; // 정규식 0~9, a~z, A~Z, -, _, .내에서만 입력가능
                    if (!emailLimit.test(input[5].value)) {  //입력값과 정규식 범위와 같지 않다면
                        // 이메일의 오류 문구삽입
                        document.getElementById(errorId[5]).innerHTML = " 올바른 형식이 아닙니다. 영문,숫자, (-)(_)(.) 입력만 가능합니다.";
                    }
                }
                    //submit 실행시 수행할 동작
            join.onsubmit = function() { //join에서 submit이 실행된다면 수행할 함수           
                var errorStr = [ " 아이디를", " 비밀번호를", " 비밀번호 확인을", " 성함을", " 휴대폰번호를", " 이메일을" ];
                
                innerReset(error); // 오류문구 초기화
                
                // [ input 공백확인 ]
                for (var i = 0; i < input.length - 1; i++) { // -1 == submit제외 
                if (!input[i].value) { 
                    document.getElementById(errorId[i]).innerHTML = errorStr[i]+ " 입력해 주세요.";
                    input[i].focus(); // 포커스 이동
                    return false; // 종료 (포커스 이동유지를 위해 false 종료)
                }
                }         
            
                //유효성검사) 비밀번호 재확인
                if (join.pw.value != join.pwCheck.value) {
                document.getElementById("pwCheckError").innerHTML = " 비밀번호가 일치하지 않습니다.";
                join.pwCheck.focus(); // 포커스 이동
                return false;
                }

                // 정규식 변수 모음     
                var idLimit = /^[a-zA-Z0-9-_]{5,20}$/; //정규식(a~z, A~Z, 0~9, -, _만 입력가능)
                var pwLimit = /^[a-zA-Z0-9~!@#$%^&*()_-]{10,20}$/;///[a-zA-Z0-9]{10, 20}/; //정규식(a~z, A~Z, 0~9,~!@#$%^&*()_-특수문자 만 입력가능)
                var pnumLimit =  /^01[0|1|6|7|8|9]{1}[0-9]{8}$/; // 01로 시작, 0,1,6,7,8,9 중 한자리, 0~9에서 8자리 입력
                var emailLimit = /[0-9a-zA-Z-_.]/; // 정규식 0~9, a~z, A~Z, -, _, .내에서만 입력가능

                // [ ID 유효성검사 ]
                if (!idLimit.test(input[0].value)) {
                document.getElementById(errorId[0]).innerHTML = " 5~20자의 영문 소대문자, 숫자와 특수기호(_),(-)만 사용 가능합니다.";
                join.id.focus(); // 포커스 이동
                return false;
                }

                // [ PW 유효성검사 ]
                if (!pwLimit.test(input[1].value)) {
                document.getElementById(errorId[1]).innerHTML = " 10~20자의 영문 소대문자, 숫자와 특수기호 '~!@#$%^&*()_-'만 사용 가능합니다.";
                //console.log(input[1].value);
                //console.log(pwLimit.test(input[1].value));
                join.pw.focus(); // 포커스 이동
                return false;
                }         

                

            // [ 휴대폰번호 유효성검사 ]
                if (!pnumLimit.test(input[4].value)) { 
                document.getElementById(errorId[4]).innerHTML = " 올바른 형식이 아닙니다. 다시 확인해주세요.";
                join.phoneNum.focus(); // 포커스 이동
                return false;
                }

            // [ email 아이디 유효성검사 ]
                if (!emailLimit.test(input[5].value)) { 
                document.getElementById(errorId[5]).innerHTML = " 올바른 형식이 아닙니다. 영문,숫자, (-)(_)(.) 외 입력은 불가합니다.";
                join.email.focus(); // 포커스 이동
                return false;
                }

            // [ email 주소선택 유효성검사 ]
                if (document.getElementById("mail_Select").value=="이메일 선택") { 
                document.getElementById(errorId[5]).innerHTML = " 이메일을 선택해주세요.";
                return false;
                }
                //console.log(document.getElementById("mail_Select").value);

                const idToPost = document.getElementById('id').value;
                const pwToPost = document.getElementById('pw').value;
                const nameToPost= document.getElementById('name').value;
                const phoneNumToPost = document.getElementById('phoneNum').value;
                const emailToPost = document.getElementById("mail_Select").value;

                document.write(idToPost);

                fetch("http://3.36.62.87/user/api/register.php", {
                    method: "POST",
                    headers: {
                      "Content-Type": "application/json",
                      "origin" : "http://3.36.62.87"
                    },
                    body: JSON.stringify({
                        "id" : idToPost,
                        "name" : nameToPost,
                        "password" : pwToPost,
                        "email" : emailToPost,
                        "address" : "공백",
                        "phone_number" : phoneNumToPost,
                        "home_number" : "0000",
                        "birthday" : "없음"
                    }),
                }).then((response) => console.log(response));
                
                  
                alert("회원가입이 완료되었습니다!")
                window.location.replace("../mainpage.html");
            }//join.onsublit
                
        }//window
            </script>
</body>
    
</html>